# Comparing `tmp/sc_inclusive_balance_detail_analysis-0.0.5-py3-none-any.whl.zip` & `tmp/sc_inclusive_balance_detail_analysis-0.0.6-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,19 +1,19 @@
-Zip file size: 23045 bytes, number of entries: 17
--rw-r--r--  2.0 unx     1192 b- defN 23-Nov-21 13:30 sc_inclusive_balance_detail_analysis/__init__.py
--rw-r--r--  2.0 unx    10649 b- defN 22-Dec-14 01:00 sc_inclusive_balance_detail_analysis/main.py
--rw-r--r--  2.0 unx     8979 b- defN 22-Dec-14 01:00 sc_inclusive_balance_detail_analysis/manifest_utils.py
--rw-r--r--  2.0 unx     1132 b- defN 22-Dec-07 03:09 sc_inclusive_balance_detail_analysis/analyzer/__init__.py
--rw-r--r--  2.0 unx     2486 b- defN 22-Dec-14 01:19 sc_inclusive_balance_detail_analysis/analyzer/base_analyzer.py
--rw-r--r--  2.0 unx     8682 b- defN 23-Nov-30 02:17 sc_inclusive_balance_detail_analysis/analyzer/inclusive_balance_detail_analyzer.py
--rw-r--r--  2.0 unx     1133 b- defN 22-Dec-07 03:09 sc_inclusive_balance_detail_analysis/summary/__init__.py
--rw-r--r--  2.0 unx     4381 b- defN 22-Dec-14 01:10 sc_inclusive_balance_detail_analysis/summary/branch_summary_analyzer.py
--rw-r--r--  2.0 unx     3488 b- defN 22-Dec-14 01:10 sc_inclusive_balance_detail_analysis/summary/manager_summary_analyzer.py
--rw-r--r--  2.0 unx     1114 b- defN 22-Dec-14 00:45 sc_inclusive_balance_detail_analysis/tests/__init__.py
--rw-r--r--  2.0 unx     5740 b- defN 23-Nov-21 13:30 sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml
--rw-r--r--  2.0 unx     1076 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/LICENSE
--rw-r--r--  2.0 unx     2148 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/WHEEL
--rw-r--r--  2.0 unx      104 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       37 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1955 b- defN 23-Nov-30 02:24 sc_inclusive_balance_detail_analysis-0.0.5.dist-info/RECORD
-17 files, 54388 bytes uncompressed, 19643 bytes compressed:  63.9%
+Zip file size: 23026 bytes, number of entries: 17
+-rw-r--r--  2.0 unx     1192 b- defN 24-May-13 02:02 sc_inclusive_balance_detail_analysis/__init__.py
+-rw-r--r--  2.0 unx    10641 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/main.py
+-rw-r--r--  2.0 unx     8979 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/manifest_utils.py
+-rw-r--r--  2.0 unx     1132 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/analyzer/__init__.py
+-rw-r--r--  2.0 unx     2367 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/analyzer/base_analyzer.py
+-rw-r--r--  2.0 unx    10576 b- defN 24-May-13 02:02 sc_inclusive_balance_detail_analysis/analyzer/inclusive_balance_detail_analyzer.py
+-rw-r--r--  2.0 unx     1133 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/summary/__init__.py
+-rw-r--r--  2.0 unx     3291 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/summary/branch_summary_analyzer.py
+-rw-r--r--  2.0 unx     3478 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/summary/manager_summary_analyzer.py
+-rw-r--r--  2.0 unx     1114 b- defN 24-May-13 02:01 sc_inclusive_balance_detail_analysis/tests/__init__.py
+-rw-r--r--  2.0 unx     5708 b- defN 24-May-11 01:44 sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml
+-rw-r--r--  2.0 unx     1076 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2148 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/WHEEL
+-rw-r--r--  2.0 unx      104 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       37 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1956 b- defN 24-May-13 02:37 sc_inclusive_balance_detail_analysis-0.0.6.dist-info/RECORD
+17 files, 55024 bytes uncompressed, 19624 bytes compressed:  64.3%
```

## zipnote {}

```diff
@@ -27,26 +27,26 @@
 
 Filename: sc_inclusive_balance_detail_analysis/tests/__init__.py
 Comment: 
 
 Filename: sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/LICENSE
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/LICENSE
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/METADATA
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/METADATA
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/WHEEL
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/WHEEL
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/entry_points.txt
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/entry_points.txt
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/top_level.txt
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/top_level.txt
 Comment: 
 
-Filename: sc_inclusive_balance_detail_analysis-0.0.5.dist-info/RECORD
+Filename: sc_inclusive_balance_detail_analysis-0.0.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## sc_inclusive_balance_detail_analysis/__init__.py

```diff
@@ -1,10 +1,10 @@
 # The MIT License (MIT)
 #
-# Copyright (c) 2023 Scott Lau
+# Copyright (c) 2024 Scott Lau
 #
 # Permission is hereby granted, free of charge, to any person obtaining a copy
 # of this software and associated documentation files (the "Software"), to deal
 # in the Software without restriction, including without limitation the rights
 # to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 # copies of the Software, and to permit persons to whom the Software is
 # furnished to do so, subject to the following conditions:
@@ -16,10 +16,10 @@
 # IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 # FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 # AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 # LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 # SOFTWARE.
 
-__version__ = "0.0.5"
+__version__ = "0.0.6"
 
 PROJECT_NAME = 'sc-inclusive-balance-detail-analysis'
```

## sc_inclusive_balance_detail_analysis/main.py

```diff
@@ -1,10 +1,10 @@
 # The MIT License (MIT)
 #
-# Copyright (c) 2022 Scott Lau
+# Copyright (c) 2024 Scott Lau
 #
 # Permission is hereby granted, free of charge, to any person obtaining a copy
 # of this software and associated documentation files (the "Software"), to deal
 # in the Software without restriction, including without limitation the rights
 # to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 # copies of the Software, and to permit persons to whom the Software is
 # furnished to do so, subject to the following conditions:
@@ -48,17 +48,17 @@
         ConfigUtils.clear(project_name)
         self._config = ConfigUtils.get_config(project_name)
         # 生成的目标Excel文件存放路径
         self._target_directory = self._config.get("inclusive.target_directory")
         # 目标文件名称
         self._target_filename = self._config.get("inclusive.target_filename")
         # 生成的Excel中按客户经理汇总的Sheet的名称
-        self._target_manager_summary_sheet_name = self._config.get("inclusive.target_manager_summary_sheet_name")
+        self._target_manager_summary_sheet_name = self._config.get("inclusive.manager_summary.business_type")
         # 生成的Excel中按客户经理汇总的Sheet的名称
-        self._target_branch_summary_sheet_name = self._config.get("inclusive.target_branch_summary_sheet_name")
+        self._target_branch_summary_sheet_name = self._config.get("inclusive.branch_summary.business_type")
 
     def _load_branch_stuff(self):
         try:
             BranchUtils.set_config(self._config)
             # 加载机构名称对应表
             BranchUtils.load_branch_name_mapping()
             # 加载公共户关键字列表
```

## sc_inclusive_balance_detail_analysis/manifest_utils.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
```

## sc_inclusive_balance_detail_analysis/analyzer/__init__.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
```

## sc_inclusive_balance_detail_analysis/analyzer/base_analyzer.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
@@ -43,18 +43,14 @@
     """
     分析基础类
     """
 
     def __init__(self, *, config: ConfigManager, excel_writer: pd.ExcelWriter):
         super().__init__(config=config, excel_writer=excel_writer)
 
-    def write_detail_report(self, data: pd.DataFrame):
-        # 不输出源报表的明细分析结果
-        pass
-
     def _calculate_column_index_from_config(self, config: ConfigManager, key: str) -> int:
         config_str = config.get(key)
         try:
             return calculate_column_index(config_str)
         except ValueError as e:
             logging.getLogger(__name__).error("configuration {} is invalid".format(key), exc_info=e)
             raise e
```

## sc_inclusive_balance_detail_analysis/analyzer/inclusive_balance_detail_analyzer.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2023. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
@@ -18,15 +18,14 @@
 #  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 #  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 #  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 #  SOFTWARE.
 
 import logging
 
-import numpy as np
 import pandas as pd
 from config42 import ConfigManager
 
 from sc_inclusive_balance_detail_analysis.manifest_utils import ManifestUtils
 from .base_analyzer import BaseAnalyzer
 
 
@@ -58,18 +57,27 @@
                 self._client_adjustments[client_no][manager_a] = manager_b
 
         self._header_row = config.get("inclusive.balance_detail.sheet_config.header_row")
         # 客户编号列索引
         self._client_no_column = self._calculate_column_index_from_config(
             config, "inclusive.balance_detail.sheet_config.client_no_column"
         )
+        # 客户名称列索引
+        self._client_name_column = self._calculate_column_index_from_config(
+            config, "inclusive.balance_detail.sheet_config.client_name_column"
+        )
         # 客户经理列索引
         self._name_column = self._calculate_column_index_from_config(
             config, "inclusive.balance_detail.sheet_config.name_column"
         )
+        # 是否过滤考核口径普惠贷款
+        filter_inclusive_config = config.get(
+            "inclusive.balance_detail.sheet_config.is_filter_inclusive"
+        )
+        self._is_filter_inclusive = False if filter_inclusive_config is None else filter_inclusive_config
         # 考核口径普惠贷款列索引
         self._is_inclusive_column = self._calculate_column_index_from_config(
             config, "inclusive.balance_detail.sheet_config.is_inclusive_column"
         )
         # 考核口径普惠贷款列过滤值
         self._is_inclusive_column_value = config.get(
             "inclusive.balance_detail.sheet_config.is_inclusive_column_value"
@@ -96,14 +104,15 @@
         key = "inclusive.balance_detail.sheet_config.value_column_pairs"
         self._init_value_column_config(config, key)
 
     def _read_src_file(self) -> pd.DataFrame:
         logging.getLogger(__name__).info("读取源文件：{}".format(self._src_filepath))
         data = pd.read_csv(self._src_filepath, header=self._header_row)
         self._client_no_column_name = data.columns[self._client_no_column]
+        self._client_name_column_name = data.columns[self._client_name_column]
         self._name_column_name = data.columns[self._name_column]
         self._is_inclusive_column_name = data.columns[self._is_inclusive_column]
         self._loan_product_column_name = data.columns[self._loan_product_column]
         self._init_value_column_pairs(data)
         data[self._client_no_column_name] = data[self._client_no_column_name].apply(lambda x: x.replace("'", ""))
         return data
 
@@ -120,16 +129,17 @@
         return data
 
     def _rename_target_columns(self, *, data: pd.DataFrame) -> pd.DataFrame:
         return data.rename(columns=self._value_column_pairs)
 
     def _pre_pivot_table(self, *, data: pd.DataFrame) -> pd.DataFrame:
         # 过滤考核口径普惠贷款
-        criterion1 = data[self._is_inclusive_column_name].map(lambda x: x == self._is_inclusive_column_value)
-        data = data[criterion1].copy()
+        if self._is_filter_inclusive:
+            criterion1 = data[self._is_inclusive_column_name].map(lambda x: x == self._is_inclusive_column_value)
+            data = data[criterion1].copy()
         # 过滤贷款业务品种
         if self._is_filter_loan_product:
             criterion2 = data[self._loan_product_column_name].map(lambda x: x in self._loan_product_list)
             data = data[criterion2].copy()
 
         # 做客户对应的客户经理的替换
         for row_i, row in data.iterrows():
@@ -146,40 +156,67 @@
                 client_no,
                 manager_name,
                 manager_pair_dict[manager_name],
             ))
         return data
 
     def _pivot_table(self, *, data: pd.DataFrame) -> pd.DataFrame:
-        index_columns = [self._name_column_name]
+        index_columns = list()
+        index_columns.append(self._client_no_column_name)
+        index_columns.append(self._client_name_column_name)
+        index_columns.append(self._name_column_name)
         value_columns = self._get_value_columns()
         logging.getLogger(__name__).info("按{} 透视数据项：{}".format(
             index_columns,
             value_columns,
         ))
         if data.empty:
             return pd.DataFrame(columns=index_columns + value_columns)
         table = pd.pivot_table(
             data,
             values=value_columns,
             index=index_columns,
-            aggfunc=np.sum,
+            aggfunc="sum",
             fill_value=0
         )
         return table
 
     def _after_pivot_table(self, *, data: pd.DataFrame) -> pd.DataFrame:
         return data.reset_index()
 
     def _merge_with_manifest(self, *, manifest_data: pd.DataFrame, data: pd.DataFrame) -> pd.DataFrame:
         logging.getLogger(__name__).info("与花名册合并...")
         merge_result = ManifestUtils.merge_with_manifest(
             manifest_data=manifest_data, data=data,
-            name_column_name=self._name_column_name
+            name_column_name=self._name_column_name,
         )
+        # 过滤客户名称为空的行
+        merge_result.drop(merge_result[merge_result[self._client_name_column_name].isna()].index, inplace=True)
+        # 调整客户名称列排序（排第二）
+        mr_client_name = merge_result[self._client_name_column_name]
+        merge_result.drop(columns=[self._client_name_column_name], inplace=True)
+        merge_result.insert(0, self._client_name_column_name, mr_client_name)
+        # 调整客户编号列排序（排第一）
+        mr_client_no = merge_result[self._client_no_column_name]
+        merge_result.drop(columns=[self._client_no_column_name], inplace=True)
+        merge_result.insert(0, self._client_no_column_name, mr_client_no)
         return merge_result
 
     def _drop_duplicated_columns(self, *, data: pd.DataFrame) -> pd.DataFrame:
         return data.drop(columns=[self._name_column_name])
 
     def _add_target_columns(self) -> None:
         self._add_value_pair_target_columns()
+
+    def write_detail_report(self, data: pd.DataFrame):
+        # 如果未启用，则直接返回
+        if not self._enabled():
+            return
+        # 读取源文件失败
+        if data is None:
+            return
+        # 这里输出的是按客户名称汇总数据
+        data.to_excel(
+            excel_writer=self._excel_writer,
+            index=False,
+            sheet_name=self._client_name_column_name + "汇总",
+        )
```

## sc_inclusive_balance_detail_analysis/summary/__init__.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
```

## sc_inclusive_balance_detail_analysis/summary/branch_summary_analyzer.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
@@ -18,76 +18,50 @@
 #  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 #  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 #  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 #  SOFTWARE.
 
 import logging
 
-import numpy as np
 import pandas as pd
 from config42 import ConfigManager
 
 from sc_inclusive_balance_detail_analysis.analyzer.base_analyzer import BaseAnalyzer
 from sc_inclusive_balance_detail_analysis.manifest_utils import ManifestUtils
 
 
 class BranchSummaryAnalyzer(BaseAnalyzer):
     """
     按机构汇总分析
     """
 
     def __init__(self, *, config: ConfigManager, manager_summary: pd.DataFrame, target_column_list: list,
                  excel_writer: pd.ExcelWriter):
-        self._business_type_summary_dict: dict = dict()
         super().__init__(config=config, excel_writer=excel_writer)
         self._manager_summary = manager_summary
         self._key_enabled = "inclusive.branch_summary.enabled"
         self._key_business_type = "inclusive.branch_summary.business_type"
         self._target_column_list = list()
         self._target_column_list.extend(target_column_list)
 
-    def _enabled(self):
-        """始终启用机构汇总分析"""
-        return True
-
-    def _read_config(self, *, config: ConfigManager):
-        # 汇总
-        dict_config = config.get("inclusive.branch_summary.business_type_summary")
-        if dict_config is not None and type(dict_config) == dict:
-            self._business_type_summary_dict.update(dict_config)
-
     def _read_src_file(self) -> pd.DataFrame:
         return self._manager_summary
 
     def _pivot_table(self, *, data: pd.DataFrame) -> pd.DataFrame:
         # 没有统计列，则不处理
         if len(self._target_column_list) == 0:
             return data
         table = pd.pivot_table(
             data, values=self._target_column_list,
             index=[ManifestUtils.get_branch_column_name()],
-            aggfunc=np.sum,
+            aggfunc="sum",
             fill_value=0,
             # 添加按列合计
             margins=True, margins_name="合计",
         )
-        # 添加个经小计、个消小计
-        real_key_list = list()
-        for sum_key, column_list in self._business_type_summary_dict.items():
-            real_column_list = list()
-            for column in column_list:
-                if column in self._target_column_list:
-                    real_column_list.append(column)
-            key = sum_key + "小计"
-            real_key_list.append(key)
-            if len(real_column_list) > 0:
-                table[key] = table[real_column_list].apply(lambda x: x.sum(), axis=1)
-            else:
-                table[key] = 0
-            self._target_column_list.append(key)
         # 调整列的顺序，合计排两个小计的前面
         table = table[self._target_column_list]
         return table
 
     def _after_pivot_table(self, *, data: pd.DataFrame) -> pd.DataFrame:
         return data.reset_index()
```

## sc_inclusive_balance_detail_analysis/summary/manager_summary_analyzer.py

```diff
@@ -1,10 +1,10 @@
 #  The MIT License (MIT)
 #
-#  Copyright (c) 2022. Scott Lau
+#  Copyright (c) 2024. Scott Lau
 #
 #  Permission is hereby granted, free of charge, to any person obtaining a copy
 #  of this software and associated documentation files (the "Software"), to deal
 #  in the Software without restriction, including without limitation the rights
 #  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 #  copies of the Software, and to permit persons to whom the Software is
 #  furnished to do so, subject to the following conditions:
@@ -22,54 +22,58 @@
 
 import logging
 
 import pandas as pd
 from config42 import ConfigManager
 
 from sc_inclusive_balance_detail_analysis.analyzer.base_analyzer import BaseAnalyzer
+from sc_inclusive_balance_detail_analysis.manifest_utils import ManifestUtils
 
 
 class ManagerSummaryAnalyzer(BaseAnalyzer):
     """
     按客户经理汇总分析
     """
 
     def __init__(self, *, config: ConfigManager, excel_writer: pd.ExcelWriter, target_column_list: list):
-        self._business_type_summary_dict: dict = dict()
         super().__init__(config=config, excel_writer=excel_writer)
+        self._key_enabled = "inclusive.manager_summary.enabled"
+        self._key_business_type = "inclusive.manager_summary.business_type"
         self._target_column_list = list()
         self._target_column_list.extend(target_column_list)
 
-    def _read_config(self, *, config: ConfigManager):
-        # 汇总
-        dict_config = config.get("inclusive.branch_summary.business_type_summary")
-        if dict_config is not None and type(dict_config) == dict:
-            self._business_type_summary_dict.update(dict_config)
-
     def analysis(self, *, manifest_data: pd.DataFrame, previous_data: pd.DataFrame) -> pd.DataFrame:
         # 读取业务类型
-        self._business_type = "客户经理汇总"
+        self._business_type = self._config.get(self._key_business_type)
+        # 如果未启用，则直接返回上一次的分析数据
+        if not self._enabled():
+            # 处理缺少配置的情况下日志记录不到具体分析类型的问题
+            business_type = self._business_type
+            if business_type is None:
+                business_type = self._key_business_type
+            logging.getLogger(__name__).info("{} 分析未启用".format(business_type))
+            return previous_data
         logging.getLogger(__name__).info("开始分析 {} 数据".format(self._business_type))
-        old_columns = list(previous_data.columns.values)
-        if len(self._target_column_list) > 0:
-            # 添加个经小计、个消小计
-            real_key_list = list()
-            for sum_key, column_list in self._business_type_summary_dict.items():
-                real_column_list = list()
-                for column in column_list:
-                    if column in self._target_column_list:
-                        real_column_list.append(column)
-                key = sum_key + "小计"
-                real_key_list.append(key)
-                if len(real_column_list) > 0:
-                    previous_data[key] = previous_data[real_column_list].apply(lambda x: x.sum(), axis=1)
-                else:
-                    previous_data[key] = 0
-                self._target_column_list.append(key)
-            # 调整列的顺序，合计排两个小计的前面
-            previous_data = previous_data[old_columns + real_key_list]
+
+        # 没有统计列，则不处理
+        if len(self._target_column_list) == 0:
+            return previous_data
+        data = pd.pivot_table(
+            previous_data, values=self._target_column_list,
+            index=[
+                ManifestUtils.get_id_column_name(),
+                ManifestUtils.get_name_column_name(),
+                ManifestUtils.get_branch_column_name(),
+            ],
+            aggfunc="sum",
+            fill_value=0,
+            # 添加按列合计
+            margins=True,
+            margins_name="合计",
+        )
+        data.reset_index(inplace=True)
         logging.getLogger(__name__).info("完成分析 {} 数据".format(self._business_type))
-        return previous_data
+        return data
 
     def write_origin_data(self):
         # 汇总不输出明细数据，否则会将真正的汇总给覆盖掉
         pass
```

## sc_inclusive_balance_detail_analysis/tests/__init__.py

```diff
@@ -1,10 +1,10 @@
 # The MIT License (MIT)
 #
-# Copyright (c) 2022 Scott Lau
+# Copyright (c) 2024 Scott Lau
 #
 # Permission is hereby granted, free of charge, to any person obtaining a copy
 # of this software and associated documentation files (the "Software"), to deal
 # in the Software without restriction, including without limitation the rights
 # to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 # copies of the Software, and to permit persons to whom the Software is
 # furnished to do so, subject to the following conditions:
```

## sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml

```diff
@@ -8,19 +8,19 @@
   source_file_path: 广州分行各团队、部室成员名单.xlsx
   # Sheet名称
   sheet_name: Sheet1
   sheet_config:
     # 表头行索引
     header_row: 1
     # 工号列索引
-    id_column: D
+    id_column: B
     # 姓名列索引
     name_column: C
     # 所属机构列索引
-    branch_column: B
+    branch_column: D
 
 # 机构相关配置
 branch:
   # 公共户名关键字列表
   common_account_keyword:
     - 公共
     - 虚拟
@@ -28,28 +28,27 @@
   gz_common_account: 广州分行公共
   # 名称转换配置
   name_mapping:
     广州分行: 广州分行行领导
     广州分行公共: 广州分行公共
     广州分行粤能支行: 粤能支行
     广州粤能支行: 粤能支行
-    广州分行财智支行: 财智支行
-    广州财智支行: 财智支行
+    广州分行海珠支行: 海珠支行
+    广州海珠支行: 海珠支行
     广州分行江湾支行: 江湾支行
     广州江湾支行: 江湾支行
     广州分行黄埔支行: 黄埔支行
     广州黄埔支行: 黄埔支行
-    广州分行美博城支行: 东风支行
-    广州美博城支行: 东风支行
-    美博城支行: 东风支行
+    广州分行东风支行: 东风支行
     广州东风支行: 东风支行
     广东分行自贸试验区南沙支行: 南沙支行
     广东自贸试验区南沙支行: 南沙支行
     自贸试验区南沙支行: 南沙支行
-    广州分行营业部: 分行营业部
+    分行营业部: 营业部
+    广州分行营业部: 营业部
     广州分行运营管理部: 运营管理部
     广州运营管理部: 运营管理部
     广州分行公司业务管理部: 公司业务管理部
     广州公司业务管理部: 公司业务管理部
     广州分行中小企业管理部: 中小企业管理部
     广州中小企业管理部: 中小企业管理部
     中小企业部: 中小企业管理部
@@ -86,18 +85,14 @@
 
 # 普惠
 inclusive:
   # 生成的目标Excel文件存放路径
   target_directory: ./
   # 目标文件名称
   target_filename: 普惠相关数据余额明细分析.xlsx
-  # 生成的Excel中按客户经理汇总的Sheet的名称
-  target_manager_summary_sheet_name: 客户经理汇总
-  # 生成的Excel中按客户经理汇总的Sheet的名称
-  target_branch_summary_sheet_name: 机构汇总
   # 普惠相关数据余额明细
   balance_detail:
     # 是否启用分析，True：分析，False：不分析
     enabled: true
     # 业务分类类型说明
     business_type: 普惠相关数据余额明细(支行)_下载
     # 普惠相关数据余额明细(支行)
@@ -111,16 +106,20 @@
     # Sheet名称
     sheet_name: 普惠相关数据余额明细(支行)
     sheet_config:
       # 表头行索引
       header_row: 0
       # 客户编号列索引
       client_no_column: C
+      # 客户名称列索引
+      client_name_column: E
       # 客户经理列索引
       name_column: AL
+      # 是否过滤考核口径普惠贷款
+      is_filter_inclusive: false
       # 考核口径普惠贷款列索引
       is_inclusive_column: BE
       # 考核口径普惠贷款列过滤值（只要'是'的值）
       is_inclusive_column_value: 是
       # 是否过滤贷款业务品种
       is_filter_loan_product: false
       # 贷款业务品种列索引
@@ -141,17 +140,21 @@
       value_column_pairs:
         # 列索引：输出的列名
         V: 贷款余额
       # 源数据导出，所有需要导出列的索引列表
       export_column_list: [ all ]
 
 
+  # 按客户经理汇总分析
+  manager_summary:
+    # 是否启用分析，True：分析，False：不分析
+    enabled: true
+    # 业务分类类型说明
+    business_type: 客户经理汇总
+
+
   # 按机构汇总分析
   branch_summary:
     # 是否启用分析，True：分析，False：不分析
     enabled: true
     # 业务分类类型说明
     business_type: 机构汇总
-    # 大类汇总
-#    business_type_summary:
-#      贷款余额:
-#        - 贷款余额
```

## Comparing `sc_inclusive_balance_detail_analysis-0.0.5.dist-info/LICENSE` & `sc_inclusive_balance_detail_analysis-0.0.6.dist-info/LICENSE`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 The MIT License (MIT)
 
-Copyright (c) 2022 Scott Lau
+Copyright (c) 2024 Scott Lau
 
 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:
```

## Comparing `sc_inclusive_balance_detail_analysis-0.0.5.dist-info/METADATA` & `sc_inclusive_balance_detail_analysis-0.0.6.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sc-inclusive-balance-detail-analysis
-Version: 0.0.5
+Version: 0.0.6
 Summary: python project
 Home-page: https://github.com/Scott-Lau/sc-inclusive-balance-detail-analysis
 Author: Scott Lau
 Author-email: exceedego@126.com
 License: MIT
 Keywords: python
 Platform: POSIX
```

## Comparing `sc_inclusive_balance_detail_analysis-0.0.5.dist-info/RECORD` & `sc_inclusive_balance_detail_analysis-0.0.6.dist-info/RECORD`

 * *Files 15% similar despite different names*

```diff
@@ -1,17 +1,17 @@
-sc_inclusive_balance_detail_analysis/__init__.py,sha256=3KENcp-zr77S49lLHvfLuZriGNNepW4eN-1cwrSpTqY,1192
-sc_inclusive_balance_detail_analysis/main.py,sha256=sA71_rq2tnoPW8dZX2olvzJJx_gENxS60SrtV0IHSto,10649
-sc_inclusive_balance_detail_analysis/manifest_utils.py,sha256=pgjXw0ALm1ERQZhw4hoCm0Am5A5rhxfom_1ztevFSHY,8979
-sc_inclusive_balance_detail_analysis/analyzer/__init__.py,sha256=nnFlO-f_84tHmjU-u0XqC4miLnw4HuzAfEYX43HMBWI,1132
-sc_inclusive_balance_detail_analysis/analyzer/base_analyzer.py,sha256=pihOeSnWODqHAKKx9vN74oqe2AtUeYS4ijHztaDKTj0,2486
-sc_inclusive_balance_detail_analysis/analyzer/inclusive_balance_detail_analyzer.py,sha256=LjAp64gX-yKv-GEhfNooUKfwUnInvF9hN3_SBSPyM7Q,8682
-sc_inclusive_balance_detail_analysis/summary/__init__.py,sha256=hEJl3cjx5NpyvZNJsDRUVFzuXuoCFZiIb9EfVtuyAhw,1133
-sc_inclusive_balance_detail_analysis/summary/branch_summary_analyzer.py,sha256=aUbkzkC0V9Q8sDM2dSJDbzFWZFWkugJANrAs1NK8iy4,4381
-sc_inclusive_balance_detail_analysis/summary/manager_summary_analyzer.py,sha256=GbcRa2SX-Ucmk3vx2yTIwFPy-ZQTeayVGO4kRDaz8aQ,3488
-sc_inclusive_balance_detail_analysis/tests/__init__.py,sha256=5QNcohCZooPxnY9TtRMJ3w2cHgggAPl99Jp9-GIFTe0,1114
-sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml,sha256=leYy7oHaFxt3fGtGr2If69EQnF684enVKDYredM0P4E,5740
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/LICENSE,sha256=48l_zi7sXkPAoMS5fF_oFZuBFReKAuNfmzYynXjjaB4,1076
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/METADATA,sha256=XZkm8RD_XYjGIJVOqg3p8UdXPVf1mZbd_0Dv446yZzg,2148
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/entry_points.txt,sha256=NXyqNTAc6VTh__M4WKpCIKOBdm9GtXrd4qZN_NtSoQ4,104
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/top_level.txt,sha256=C88Np6q-ZTsJKW0vVX6zLvYoMdPfjRTe5tYZMjEgH-o,37
-sc_inclusive_balance_detail_analysis-0.0.5.dist-info/RECORD,,
+sc_inclusive_balance_detail_analysis/__init__.py,sha256=rPEwhnW0JG2OaQhW8goiYCAf7_KxqWy7PvgnkBIgY0I,1192
+sc_inclusive_balance_detail_analysis/main.py,sha256=SPRBB4v1k10Pt00MohTYsSu-pxYCRdgendEDLERyECE,10641
+sc_inclusive_balance_detail_analysis/manifest_utils.py,sha256=EO8-SzQngXF1Hs9D81KYe1VVt1aXK5Hy3A4nCei6Wqs,8979
+sc_inclusive_balance_detail_analysis/analyzer/__init__.py,sha256=oYfeavAdvW8mGv2eEw6yso0qgU9orhUs6m9KeiBtuYY,1132
+sc_inclusive_balance_detail_analysis/analyzer/base_analyzer.py,sha256=-3WNLB1RZQiHyWbPfxQ8cqobacSLmEeqo1-cLFieflI,2367
+sc_inclusive_balance_detail_analysis/analyzer/inclusive_balance_detail_analyzer.py,sha256=Ub4bXUMvVF5Yukd2oVC_ZmipqgML8IskqP-E13suA3I,10576
+sc_inclusive_balance_detail_analysis/summary/__init__.py,sha256=4PfOoraWuk50ZHQ-VeJyUbTazsuINRhEVtGUBOZ8tcA,1133
+sc_inclusive_balance_detail_analysis/summary/branch_summary_analyzer.py,sha256=jk1cLqdm5SbTSfT6YSee9XKgMGboLOT3sm39UDbA72s,3291
+sc_inclusive_balance_detail_analysis/summary/manager_summary_analyzer.py,sha256=ToGurN-xrTnHM62j_pZlOeSlgDtMl7cxGcL42o4NuCM,3478
+sc_inclusive_balance_detail_analysis/tests/__init__.py,sha256=Fgsv7kmTdE6VUCY09rmQiM4eHHaziC60aOF0kA6Y8Pw,1114
+sc_inclusive_balance_detail_analysis/tests/sample_config/production.yml,sha256=i2-EY1WrPtAU7ndr3zdH0KwVvSBy7vhV3zylMvBiPTk,5708
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/LICENSE,sha256=gAuQR9WCISwCCgA3rUNidk-y12Z6fGCGvDp8zPNEidw,1076
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/METADATA,sha256=kXABCudjoaR3a7I01cJnpFTup61qLQLBGO5G6nUmr84,2148
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/entry_points.txt,sha256=NXyqNTAc6VTh__M4WKpCIKOBdm9GtXrd4qZN_NtSoQ4,104
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/top_level.txt,sha256=C88Np6q-ZTsJKW0vVX6zLvYoMdPfjRTe5tYZMjEgH-o,37
+sc_inclusive_balance_detail_analysis-0.0.6.dist-info/RECORD,,
```

